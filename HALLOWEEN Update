local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

local FireInput = ReplicatedStorage.ReplicatedModules.KnitPackage.Knit.Services.MoveInputService.RF.FireInput
local waitPos = Vector3.new(200.6, 105.7, 1855.9)

if game:GetService("CoreGui"):FindFirstChild("MiniHalloween") then
	game:GetService("CoreGui").MiniHalloween:Destroy()
end

local gui = Instance.new("ScreenGui")
gui.Name = "MiniHalloween"
gui.Parent = game:GetService("CoreGui")

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 200, 0, 75) 
mainFrame.Position = UDim2.new(0.1, 0, 0.2, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = gui

local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0, 8)
uiCorner.Parent = mainFrame

local stroke = Instance.new("UIStroke")
stroke.Color = Color3.fromRGB(255, 255, 255)
stroke.Transparency = 0.8
stroke.Parent = mainFrame

local farmButton = Instance.new("TextButton")
farmButton.Size = UDim2.new(1, -40, 0, 35)
farmButton.Position = UDim2.new(0, 5, 0, 2)
farmButton.BackgroundTransparency = 1
farmButton.Text = "Farm Halloween: OFF"
farmButton.TextColor3 = Color3.fromRGB(200, 200, 200)
farmButton.Font = Enum.Font.GothamBold
farmButton.TextSize = 13
farmButton.Parent = mainFrame

local posButton = Instance.new("TextButton")
posButton.Size = UDim2.new(1, -40, 0, 35)
posButton.Position = UDim2.new(0, 5, 0, 38) 
posButton.BackgroundTransparency = 1
posButton.Text = "Pos: Behind"
posButton.TextColor3 = Color3.fromRGB(255, 200, 80)
posButton.Font = Enum.Font.GothamBold
posButton.TextSize = 13
posButton.Parent = mainFrame

local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 35, 0, 35)
closeButton.Position = UDim2.new(1, -35, 0, 0)
closeButton.BackgroundColor3 = Color3.fromRGB(180, 40, 40)
closeButton.BackgroundTransparency = 0.2
closeButton.Text = "X"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 14
closeButton.Parent = mainFrame

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 8)
closeCorner.Parent = closeButton

local farmEnabled = false
local farmTargets = {"Vampire", "Werewolf", "Skeleton", "Ghost", "Ghoul"}
local currentTarget = nil
local currentTargetRoot = nil

local posModes = {"Behind", "Above", "Below"}
local posIndex = 1

farmButton.MouseButton1Click:Connect(function()
	farmEnabled = not farmEnabled
	if farmEnabled then
		farmButton.Text = "Farm Halloween: ON"
		farmButton.TextColor3 = Color3.fromRGB(80, 255, 80)
	else
		farmButton.Text = "Farm Halloween: OFF"
		farmButton.TextColor3 = Color3.fromRGB(200, 200, 200)
		currentTarget = nil
		currentTargetRoot = nil
	end
end)

posButton.MouseButton1Click:Connect(function()
	posIndex = posIndex + 1
	if posIndex > #posModes then posIndex = 1 end
	posButton.Text = "Pos: " .. posModes[posIndex]
end)

closeButton.MouseButton1Click:Connect(function()
	farmEnabled = false
	gui:Destroy()
end)

local function getNearestTarget()
	local nearest = nil
	local minDst = math.huge
	local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
	
	if not root or not workspace:FindFirstChild("Living") then return nil end

	for _, v in pairs(workspace.Living:GetChildren()) do
		local hum = v:FindFirstChildOfClass("Humanoid")
		if hum and hum.Health > 0 then
			if table.find(farmTargets, v.Name) or table.find(farmTargets, hum.DisplayName) then
				local tRoot = v:FindFirstChild("HumanoidRootPart") or v:FindFirstChild("Torso")
				if tRoot then
					local dst = (root.Position - tRoot.Position).Magnitude
					if dst < minDst then
						minDst = dst
						nearest = v
					end
				end
			end
		end
	end
	return nearest
end

RunService.Heartbeat:Connect(function()
	if not farmEnabled then return end

	local char = LocalPlayer.Character
	local hrp = char and char:FindFirstChild("HumanoidRootPart")
	if not hrp then return end

	local isTargetValid = false
	if currentTarget and currentTarget.Parent and currentTargetRoot and currentTargetRoot.Parent then
		local hum = currentTarget:FindFirstChildOfClass("Humanoid")
		if hum and hum.Health > 0 then
			isTargetValid = true
		end
	end

	if isTargetValid then
		hrp.Velocity = Vector3.zero
		local tPos = currentTargetRoot.Position
		local mode = posModes[posIndex]
		local targetCFrame
		
		if mode == "Behind" then
			targetCFrame = CFrame.new(tPos + (currentTargetRoot.CFrame.LookVector * -7), tPos)
		elseif mode == "Above" then
			targetCFrame = CFrame.new(tPos + Vector3.new(0, 15, 0), tPos)
		elseif mode == "Below" then
			targetCFrame = CFrame.new(tPos + Vector3.new(0, -10, 0), tPos)
		end
		
		hrp.CFrame = targetCFrame
	else
		hrp.CFrame = CFrame.new(waitPos)
	end
end)

task.spawn(function()
	while task.wait(0.5) do
		if farmEnabled then
			local target = getNearestTarget()
			if target then
				currentTarget = target
				currentTargetRoot = target:FindFirstChild("HumanoidRootPart") or target:FindFirstChild("Torso")
			else
				currentTarget = nil
				currentTargetRoot = nil
			end
		end
	end
end)

task.spawn(function()
	while task.wait(0.2) do
		if farmEnabled and currentTarget then
			local hum = currentTarget:FindFirstChildOfClass("Humanoid")
			if hum and hum.Health > 0 then
				FireInput:InvokeServer(buffer.fromstring("\0MOUSEBUTTON1"))
			end
		end
	end
end)
